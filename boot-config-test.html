<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BootConfig Test - PTS</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #1a1a1a;
            color: #00ff00;
            margin: 0;
            padding: 20px;
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        
        h1 {
            color: #ffff00;
            text-align: center;
            margin-bottom: 30px;
        }
        
        .section {
            background: #2a2a2a;
            border: 1px solid #444;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        
        .section h2 {
            color: #00ffff;
            margin-top: 0;
        }
        
        .param-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .param-group {
            background: #333;
            padding: 15px;
            border-radius: 5px;
            border-left: 4px solid #00ff00;
        }
        
        .param-group h3 {
            color: #ffff00;
            margin-top: 0;
            margin-bottom: 10px;
        }
        
        .param-item {
            margin-bottom: 8px;
        }
        
        .param-item label {
            display: inline-block;
            width: 120px;
            font-weight: bold;
        }
        
        .param-item input, .param-item select {
            background: #1a1a1a;
            border: 1px solid #555;
            color: #00ff00;
            padding: 5px 8px;
            border-radius: 3px;
            font-family: inherit;
        }
        
        .param-item input[type="checkbox"] {
            width: auto;
        }
        
        .buttons {
            text-align: center;
            margin: 20px 0;
        }
        
        .btn {
            background: #0066cc;
            color: white;
            border: none;
            padding: 12px 24px;
            margin: 0 10px;
            border-radius: 5px;
            cursor: pointer;
            font-family: inherit;
            font-size: 14px;
        }
        
        .btn:hover {
            background: #0088ff;
        }
        
        .btn.copy {
            background: #cc6600;
        }
        
        .btn.copy:hover {
            background: #ff8800;
        }
        
        .url-display {
            background: #1a1a1a;
            border: 1px solid #555;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            word-break: break-all;
            margin: 20px 0;
        }
        
        .current-config {
            background: #1a1a1a;
            border: 1px solid #555;
            padding: 15px;
            border-radius: 5px;
            font-family: monospace;
            white-space: pre-wrap;
        }
        
        .info {
            background: #2a2a2a;
            border-left: 4px solid #0088ff;
            padding: 15px;
            margin: 20px 0;
        }
        
        .warning {
            background: #2a2a2a;
            border-left: 4px solid #ff8800;
            padding: 15px;
            margin: 20px 0;
        }
        
        .success {
            background: #2a2a2a;
            border-left: 4px solid #00ff00;
            padding: 15px;
            margin: 20px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ PTS BootConfig Test</h1>
        
        <div class="info">
            <strong>BootConfig System:</strong> This test demonstrates the URL-based boot configuration system with proper precedence handling:
            <br>Engine defaults ‚Üí Pack defaults ‚Üí SettingsStore ‚Üí URL (wins for session)
        </div>
        
        <div class="section">
            <h2>üîß Boot Parameters</h2>
            <div class="param-grid">
                <!-- Game Pack & Level -->
                <div class="param-group">
                    <h3>üì¶ Game Pack & Level</h3>
                    <div class="param-item">
                        <label>Pack:</label>
                        <input type="text" id="pack" placeholder="Built-in pack name">
                    </div>
                    <div class="param-item">
                        <label>Pack URL:</label>
                        <input type="url" id="packUrl" placeholder="https://...">
                    </div>
                    <div class="param-item">
                        <label>Level:</label>
                        <input type="number" id="level" min="1" max="999" value="1">
                    </div>
                    <div class="param-item">
                        <label>Room:</label>
                        <input type="number" id="room" min="1" max="999">
                    </div>
                    <div class="param-item">
                        <label>X Position:</label>
                        <input type="number" id="x" step="0.1">
                    </div>
                    <div class="param-item">
                        <label>Y Position:</label>
                        <input type="number" id="y" step="0.1">
                    </div>
                </div>
                
                <!-- Player State -->
                <div class="param-group">
                    <h3>üë§ Player State</h3>
                    <div class="param-item">
                        <label>Health:</label>
                        <input type="number" id="health" min="0" max="9999" value="100">
                    </div>
                    <div class="param-item">
                        <label>Max Health:</label>
                        <input type="number" id="maxhealth" min="1" max="9999" value="100">
                    </div>
                    <div class="param-item">
                        <label>Sword:</label>
                        <input type="checkbox" id="sword">
                    </div>
                </div>
                
                <!-- Game Settings -->
                <div class="param-group">
                    <h3>üéÆ Game Settings</h3>
                    <div class="param-item">
                        <label>Time:</label>
                        <input type="number" id="time" min="0" max="999999">
                    </div>
                    <div class="param-item">
                        <label>Seed:</label>
                        <input type="number" id="seed" min="0" max="999999">
                    </div>
                    <div class="param-item">
                        <label>Difficulty:</label>
                        <select id="difficulty">
                            <option value="">Default</option>
                            <option value="easy">Easy</option>
                            <option value="normal">Normal</option>
                            <option value="hard">Hard</option>
                            <option value="extreme">Extreme</option>
                        </select>
                    </div>
                </div>
                
                <!-- Cheats -->
                <div class="param-group">
                    <h3>üõ†Ô∏è Cheats</h3>
                    <div class="param-item">
                        <label>Noclip:</label>
                        <input type="checkbox" id="noclip">
                    </div>
                    <div class="param-item">
                        <label>God Mode:</label>
                        <input type="checkbox" id="god">
                    </div>
                    <div class="param-item">
                        <label>Infinite Time:</label>
                        <input type="checkbox" id="infTime">
                    </div>
                    <div class="param-item">
                        <label>Reveal:</label>
                        <input type="checkbox" id="reveal">
                    </div>
                    <div class="param-item">
                        <label>Give Sword:</label>
                        <input type="checkbox" id="givesword">
                    </div>
                    <div class="param-item">
                        <label>Set Guards:</label>
                        <input type="number" id="setguards" min="0" max="100">
                    </div>
                </div>
                
                <!-- Performance -->
                <div class="param-group">
                    <h3>‚ö° Performance</h3>
                    <div class="param-item">
                        <label>Speed:</label>
                        <input type="number" id="speed" min="0.1" max="10.0" step="0.1" value="1.0">
                    </div>
                    <div class="param-item">
                        <label>FPS:</label>
                        <input type="number" id="fps" min="30" max="240" value="60">
                    </div>
                    <div class="param-item">
                        <label>VSync:</label>
                        <input type="checkbox" id="vsync" checked>
                    </div>
                </div>
                
                <!-- Display -->
                <div class="param-group">
                    <h3>üñ•Ô∏è Display</h3>
                    <div class="param-item">
                        <label>Scale:</label>
                        <select id="scale">
                            <option value="">Default</option>
                            <option value="integer">Integer</option>
                            <option value="fit">Fit</option>
                            <option value="stretch">Stretch</option>
                        </select>
                    </div>
                    <div class="param-item">
                        <label>Zoom:</label>
                        <input type="number" id="zoom" min="0.1" max="10.0" step="0.1" value="1.0">
                    </div>
                    <div class="param-item">
                        <label>Fullscreen:</label>
                        <input type="checkbox" id="fullscreen">
                    </div>
                </div>
                
                <!-- Audio -->
                <div class="param-group">
                    <h3>üîä Audio</h3>
                    <div class="param-item">
                        <label>Mute:</label>
                        <input type="checkbox" id="mute">
                    </div>
                    <div class="param-item">
                        <label>Music:</label>
                        <input type="checkbox" id="music" checked>
                    </div>
                    <div class="param-item">
                        <label>SFX:</label>
                        <input type="checkbox" id="sfx" checked>
                    </div>
                    <div class="param-item">
                        <label>Volume:</label>
                        <input type="number" id="vol" min="0.0" max="1.0" step="0.1" value="1.0">
                    </div>
                    <div class="param-item">
                        <label>Latency:</label>
                        <select id="latency">
                            <option value="">Default</option>
                            <option value="auto">Auto</option>
                            <option value="low">Low</option>
                            <option value="compat">Compat</option>
                        </select>
                    </div>
                </div>
                
                <!-- Input -->
                <div class="param-group">
                    <h3>üéÆ Input</h3>
                    <div class="param-item">
                        <label>Keys:</label>
                        <input type="text" id="keys" placeholder="Custom key bindings">
                    </div>
                    <div class="param-item">
                        <label>Deadzone:</label>
                        <input type="number" id="deadzone" min="0.0" max="1.0" step="0.1" value="0.1">
                    </div>
                    <div class="param-item">
                        <label>Jump Buffer:</label>
                        <input type="number" id="jumpbuf" min="0" max="200" value="100">
                    </div>
                    <div class="param-item">
                        <label>Sticky:</label>
                        <input type="checkbox" id="sticky">
                    </div>
                </div>
                
                <!-- UI & Accessibility -->
                <div class="param-group">
                    <h3>üé® UI & Accessibility</h3>
                    <div class="param-item">
                        <label>HUD:</label>
                        <input type="checkbox" id="hud" checked>
                    </div>
                    <div class="param-item">
                        <label>Cutscenes:</label>
                        <input type="checkbox" id="cutscenes">
                    </div>
                    <div class="param-item">
                        <label>Language:</label>
                        <input type="text" id="lang" placeholder="en" value="en">
                    </div>
                    <div class="param-item">
                        <label>Save Slot:</label>
                        <select id="slot">
                            <option value="">No slot</option>
                            <option value="1">Slot 1</option>
                            <option value="2">Slot 2</option>
                            <option value="3">Slot 3</option>
                            <option value="Q">Quick Save</option>
                        </select>
                    </div>
                </div>
                
                <!-- Development -->
                <div class="param-group">
                    <h3>üîß Development</h3>
                    <div class="param-item">
                        <label>Editor:</label>
                        <input type="checkbox" id="editor">
                    </div>
                </div>
            </div>
            
            <div class="buttons">
                <button class="btn" onclick="generateUrl()">üîó Generate Boot URL</button>
                <button class="btn copy" onclick="copyUrl()">üìã Copy Boot Link</button>
                <button class="btn" onclick="loadFromUrl()">üì• Load from URL</button>
                <button class="btn" onclick="resetForm()">üîÑ Reset Form</button>
            </div>
        </div>
        
        <div class="section">
            <h2>üîó Generated Boot URL</h2>
            <div class="url-display" id="urlDisplay">
                Click "Generate Boot URL" to create a boot link with your settings
            </div>
        </div>
        
        <div class="section">
            <h2>üìä Current Configuration</h2>
            <div class="current-config" id="currentConfig">
                No configuration loaded
            </div>
        </div>
        
        <div class="section">
            <h2>üìù Examples</h2>
            <div class="param-grid">
                <div class="param-group">
                    <h3>üéØ Quick Start</h3>
                    <p><code>?level=3&health=200&god=1</code></p>
                    <p>Start at level 3 with 200 health and god mode</p>
                </div>
                <div class="param-group">
                    <h3>üéÆ Speed Run</h3>
                    <p><code>?speed=2.0&noclip=1&cutscenes=0</code></p>
                    <p>2x speed, noclip, skip cutscenes</p>
                </div>
                <div class="param-group">
                    <h3>üîß Debug Mode</h3>
                    <p><code>?god=1&noclip=1&infTime=1&editor=1</code></p>
                    <p>All cheats enabled + editor mode</p>
                </div>
                <div class="param-group">
                    <h3>üéµ Audio Test</h3>
                    <p><code>?vol=0.5&music=0&sfx=1</code></p>
                    <p>50% volume, no music, SFX only</p>
                </div>
            </div>
        </div>
    </div>

    <script type="module">
        import { parseBootConfig, validateBootConfig, resolveBootConfig, generateBootLink } from './src/engine/boot/BootConfig.js';
        
        // Global functions for the UI
        window.generateUrl = function() {
            const params = new URLSearchParams();
            
            // Collect all form values
            const formData = {
                pack: document.getElementById('pack').value,
                packUrl: document.getElementById('packUrl').value,
                level: document.getElementById('level').value,
                room: document.getElementById('room').value,
                x: document.getElementById('x').value,
                y: document.getElementById('y').value,
                health: document.getElementById('health').value,
                maxhealth: document.getElementById('maxhealth').value,
                sword: document.getElementById('sword').checked,
                time: document.getElementById('time').value,
                seed: document.getElementById('seed').value,
                difficulty: document.getElementById('difficulty').value,
                noclip: document.getElementById('noclip').checked,
                god: document.getElementById('god').checked,
                infTime: document.getElementById('infTime').checked,
                reveal: document.getElementById('reveal').checked,
                givesword: document.getElementById('givesword').checked,
                setguards: document.getElementById('setguards').value,
                speed: document.getElementById('speed').value,
                fps: document.getElementById('fps').value,
                vsync: document.getElementById('vsync').checked,
                scale: document.getElementById('scale').value,
                zoom: document.getElementById('zoom').value,
                fullscreen: document.getElementById('fullscreen').checked,
                mute: document.getElementById('mute').checked,
                music: document.getElementById('music').checked,
                sfx: document.getElementById('sfx').checked,
                vol: document.getElementById('vol').value,
                latency: document.getElementById('latency').value,
                keys: document.getElementById('keys').value,
                deadzone: document.getElementById('deadzone').value,
                jumpbuf: document.getElementById('jumpbuf').value,
                sticky: document.getElementById('sticky').checked,
                hud: document.getElementById('hud').checked,
                cutscenes: document.getElementById('cutscenes').checked,
                lang: document.getElementById('lang').value,
                slot: document.getElementById('slot').value,
                editor: document.getElementById('editor').checked
            };
            
            // Add non-empty values to URL params
            Object.entries(formData).forEach(([key, value]) => {
                if (value !== '' && value !== false && value !== '0') {
                    if (typeof value === 'boolean') {
                        params.set(key, '1');
                    } else {
                        params.set(key, value.toString());
                    }
                }
            });
            
            const queryString = params.toString();
            const bootUrl = queryString ? 
                `${window.location.origin}${window.location.pathname}?${queryString}` : 
                `${window.location.origin}${window.location.pathname}`;
            
            document.getElementById('urlDisplay').textContent = bootUrl;
            
            // Show current configuration
            try {
                const { config, warnings } = parseBootConfig();
                const validationWarnings = validateBootConfig(config);
                const resolvedConfig = resolveBootConfig(config);
                
                let configText = 'Parsed URL Configuration:\n';
                configText += JSON.stringify(config, null, 2);
                configText += '\n\nResolved Configuration (with precedence):\n';
                configText += JSON.stringify(resolvedConfig, null, 2);
                
                if (warnings.length > 0 || validationWarnings.length > 0) {
                    configText += '\n\nWarnings:\n';
                    [...warnings, ...validationWarnings].forEach(warning => {
                        configText += `‚ö†Ô∏è ${warning}\n`;
                    });
                }
                
                document.getElementById('currentConfig').textContent = configText;
            } catch (error) {
                document.getElementById('currentConfig').textContent = `Error parsing configuration: ${error.message}`;
            }
        };
        
        window.copyUrl = async function() {
            const urlDisplay = document.getElementById('urlDisplay');
            const url = urlDisplay.textContent;
            
            if (url && url !== 'Click "Generate Boot URL" to create a boot link with your settings') {
                try {
                    await navigator.clipboard.writeText(url);
                    showMessage('‚úÖ Boot link copied to clipboard!', 'success');
                } catch (error) {
                    showMessage('‚ùå Failed to copy to clipboard', 'warning');
                }
            } else {
                showMessage('‚ö†Ô∏è Generate a URL first', 'warning');
            }
        };
        
        window.loadFromUrl = function() {
            try {
                const { config } = parseBootConfig();
                
                // Populate form with URL parameters
                Object.entries(config).forEach(([key, value]) => {
                    const element = document.getElementById(key);
                    if (element) {
                        if (element.type === 'checkbox') {
                            element.checked = Boolean(value);
                        } else {
                            element.value = value.toString();
                        }
                    }
                });
                
                showMessage('‚úÖ Configuration loaded from URL', 'success');
            } catch (error) {
                showMessage(`‚ùå Error loading from URL: ${error.message}`, 'warning');
            }
        };
        
        window.resetForm = function() {
            // Reset all form elements to defaults
            document.getElementById('level').value = '1';
            document.getElementById('health').value = '100';
            document.getElementById('maxhealth').value = '100';
            document.getElementById('sword').checked = false;
            document.getElementById('noclip').checked = false;
            document.getElementById('god').checked = false;
            document.getElementById('infTime').checked = false;
            document.getElementById('reveal').checked = false;
            document.getElementById('givesword').checked = false;
            document.getElementById('speed').value = '1.0';
            document.getElementById('fps').value = '60';
            document.getElementById('vsync').checked = true;
            document.getElementById('zoom').value = '1.0';
            document.getElementById('mute').checked = false;
            document.getElementById('music').checked = true;
            document.getElementById('sfx').checked = true;
            document.getElementById('vol').value = '1.0';
            document.getElementById('deadzone').value = '0.1';
            document.getElementById('jumpbuf').value = '100';
            document.getElementById('sticky').checked = false;
            document.getElementById('hud').checked = true;
            document.getElementById('cutscenes').checked = false;
            document.getElementById('lang').value = 'en';
            document.getElementById('editor').checked = false;
            
            // Clear text inputs
            ['pack', 'packUrl', 'room', 'x', 'y', 'time', 'seed', 'setguards', 'keys'].forEach(id => {
                document.getElementById(id).value = '';
            });
            
            // Reset selects
            ['difficulty', 'scale', 'latency', 'slot'].forEach(id => {
                document.getElementById(id).value = '';
            });
            
            showMessage('üîÑ Form reset to defaults', 'info');
        };
        
        function showMessage(message, type) {
            const messageDiv = document.createElement('div');
            messageDiv.className = type;
            messageDiv.textContent = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(messageDiv, container.firstChild);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 3000);
        }
        
        // Load configuration from URL on page load
        window.addEventListener('load', () => {
            if (window.location.search) {
                window.loadFromUrl();
                window.generateUrl();
            }
        });
    </script>
</body>
</html> 