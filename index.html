<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PrinceTS - Retro Game Engine</title>
    <link rel="stylesheet" href="styles.css">
    <style>
        .retro-info {
            position: fixed;
            top: 10px;
            left: 10px;
            color: white;
            background: rgba(0,0,0,0.7);
            padding: 10px;
            border-radius: 5px;
            font-size: 12px;
            z-index: 1000;
            font-family: monospace;
        }
    </style>
</head>
<body>
    <div class="retro-info">
        <h3>PrinceTS Multi-Platform Engine</h3>
        <div id="platformInfo">
            <h3>Loading...</h3>
        </div>
        <p>Display: <span id="displayRes">--</span></p>
        <p>Scale: <span id="scale">--</span></p>
        <p>Controls: WASD/Arrows, Space</p>
        <p>Platform: P=Selector, Dev: F1=Debug, C=FreeCam, Esc=Menu</p>
        <p>Core: F=Fullscreen, M=Mute, `=Dev Panel, Esc=Pi Menu, D=Debug</p>
    </div>
    
    <!-- Temporary dev controls for testing core features -->
    <div id="devControls" style="position: fixed; top: 10px; right: 10px; background: rgba(0,0,0,0.8); color: white; padding: 15px; border-radius: 5px; font-family: monospace; font-size: 12px; z-index: 1000;">
        <h4>Core Features Test</h4>
        <div>
            <label>Scale Mode:</label>
            <select id="scaleModeSelect">
                <option value="integer">Integer</option>
                <option value="fit">Fit</option>
                <option value="stretch">Stretch</option>
            </select>
        </div>
        <div style="margin-top: 10px;">
            <label>Safe Area: <span id="safeAreaValue">3%</span></label><br>
            <input type="range" id="safeAreaSlider" min="0" max="10" value="3" style="width: 100px;">
        </div>
        <div style="margin-top: 10px;">
            <label>Master Volume: <span id="masterVolumeValue">100%</span></label><br>
            <input type="range" id="masterVolumeSlider" min="0" max="100" value="100" style="width: 100px;">
        </div>
        <div style="margin-top: 10px;">
            <button id="fullscreenBtn">Toggle Fullscreen</button>
            <button id="muteBtn">Toggle Mute</button>
        </div>
        <div style="margin-top: 10px;">
            <button id="exportSettingsBtn">Export Settings</button>
            <button id="resetSettingsBtn">Reset Settings</button>
        </div>
    </div>
    <canvas id="gameCanvas" tabindex="0"></canvas>
    <script type="module" src="dist/main.js"></script>
    <script>
        // Update retro scaling info
        function updateRetroInfo() {
            const canvas = document.getElementById('gameCanvas');
            const displayRes = document.getElementById('displayRes');
            const scale = document.getElementById('scale');
            
            if (canvas && canvas.width > 0) {
                displayRes.textContent = `${canvas.width}x${canvas.height}`;
                
                // Get platform resolution from URL or default
                const urlParams = new URLSearchParams(window.location.search);
                const platformKey = urlParams.get('platform') || 'snes';
                
                // Default resolutions for common platforms
                const platformResolutions = {
                    'apple-ii': {width: 280, height: 192},
                    'ibm-pc-cga': {width: 320, height: 200},
                    'ibm-pc-ega': {width: 320, height: 200},
                    'ibm-pc-vga': {width: 320, height: 200},
                    'amiga': {width: 320, height: 200},
                    'atari-st': {width: 320, height: 200},
                    'macintosh': {width: 512, height: 342},
                    'fm-towns': {width: 640, height: 480},
                    'sharp-x68000': {width: 512, height: 512},
                    'nes': {width: 256, height: 240},
                    'snes': {width: 256, height: 224},
                    'genesis': {width: 320, height: 224},
                    'sega-cd': {width: 320, height: 224},
                    'turbografx-cd': {width: 320, height: 224},
                    'game-boy': {width: 160, height: 144},
                    'game-boy-color': {width: 160, height: 144},
                    'game-gear': {width: 160, height: 144},
                    'windows-3x': {width: 320, height: 200}
                };
                
                const platformRes = platformResolutions[platformKey] || {width: 320, height: 200};
                
                // Calculate scale
                const scaleX = canvas.width / platformRes.width;
                const scaleY = canvas.height / platformRes.height;
                const actualScale = Math.min(scaleX, scaleY);
                scale.textContent = `${actualScale.toFixed(2)}x`;
            }
        }
        
        // Update info after canvas initializes
        setTimeout(updateRetroInfo, 100);
        window.addEventListener('resize', updateRetroInfo);
        
        // Dev controls for testing core features
        function setupDevControls() {
            // Scale mode selector
            const scaleModeSelect = document.getElementById('scaleModeSelect');
            if (scaleModeSelect) {
                scaleModeSelect.addEventListener('change', (e) => {
                    const mode = e.target.value;
                    if (window.ptsCore && window.ptsCore.settingsStore) {
                        window.ptsCore.settingsStore.set('video.scaleMode', mode);
                    }
                });
            }
            
            // Safe area slider
            const safeAreaSlider = document.getElementById('safeAreaSlider');
            const safeAreaValue = document.getElementById('safeAreaValue');
            if (safeAreaSlider && safeAreaValue) {
                safeAreaSlider.addEventListener('input', (e) => {
                    const value = e.target.value;
                    safeAreaValue.textContent = value + '%';
                    if (window.ptsCore && window.ptsCore.settingsStore) {
                        window.ptsCore.settingsStore.set('video.safeAreaPct', value / 100);
                    }
                });
            }
            
            // Master volume slider
            const masterVolumeSlider = document.getElementById('masterVolumeSlider');
            const masterVolumeValue = document.getElementById('masterVolumeValue');
            if (masterVolumeSlider && masterVolumeValue) {
                masterVolumeSlider.addEventListener('input', (e) => {
                    const value = e.target.value;
                    masterVolumeValue.textContent = value + '%';
                    if (window.ptsCore && window.ptsCore.settingsStore) {
                        window.ptsCore.settingsStore.set('audio.master', value / 100);
                    }
                });
            }
            
            // Fullscreen button
            const fullscreenBtn = document.getElementById('fullscreenBtn');
            if (fullscreenBtn) {
                fullscreenBtn.addEventListener('click', () => {
                    if (window.ptsCore && window.ptsCore.engine) {
                        const renderer = window.ptsCore.engine.getRenderer();
                        if (renderer.isFullscreenMode()) {
                            renderer.exitFullscreen();
                        } else {
                            renderer.requestFullscreen();
                        }
                    }
                });
            }
            
            // Mute button
            const muteBtn = document.getElementById('muteBtn');
            if (muteBtn) {
                muteBtn.addEventListener('click', () => {
                    if (window.ptsCore && window.ptsCore.audioManager && window.ptsCore.settingsStore) {
                        const currentMuted = window.ptsCore.audioManager.isMuted();
                        window.ptsCore.audioManager.setMuted(!currentMuted);
                        window.ptsCore.settingsStore.set('audio.muted', !currentMuted);
                    }
                });
            }
            
            // Export settings button
            const exportSettingsBtn = document.getElementById('exportSettingsBtn');
            if (exportSettingsBtn) {
                exportSettingsBtn.addEventListener('click', () => {
                    if (window.ptsCore && window.ptsCore.settingsStore) {
                        const json = window.ptsCore.settingsStore.exportJson();
                        const blob = new Blob([json], { type: 'application/json' });
                        const url = URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = 'pts-settings.json';
                        a.click();
                        URL.revokeObjectURL(url);
                    }
                });
            }
            
            // Reset settings button
            const resetSettingsBtn = document.getElementById('resetSettingsBtn');
            if (resetSettingsBtn) {
                resetSettingsBtn.addEventListener('click', () => {
                    if (window.ptsCore && window.ptsCore.settingsStore) {
                        if (confirm('Reset all settings to defaults?')) {
                            window.ptsCore.settingsStore.reset();
                        }
                    }
                });
            }
        }
        
        // Setup dev controls after page loads
        window.addEventListener('load', setupDevControls);
        
        // Sync dev controls with current settings
        function syncDevControls() {
            if (window.ptsCore && window.ptsCore.settingsStore) {
                const settings = window.ptsCore.settingsStore.getAll();
                
                // Update scale mode selector
                const scaleModeSelect = document.getElementById('scaleModeSelect');
                if (scaleModeSelect) {
                    scaleModeSelect.value = settings.video.scaleMode;
                }
                
                // Update safe area slider
                const safeAreaSlider = document.getElementById('safeAreaSlider');
                const safeAreaValue = document.getElementById('safeAreaValue');
                if (safeAreaSlider && safeAreaValue) {
                    const safeAreaPercent = Math.round(settings.video.safeAreaPct * 100);
                    safeAreaSlider.value = safeAreaPercent;
                    safeAreaValue.textContent = safeAreaPercent + '%';
                }
                
                // Update master volume slider
                const masterVolumeSlider = document.getElementById('masterVolumeSlider');
                const masterVolumeValue = document.getElementById('masterVolumeValue');
                if (masterVolumeSlider && masterVolumeValue) {
                    const volumePercent = Math.round(settings.audio.master * 100);
                    masterVolumeSlider.value = volumePercent;
                    masterVolumeValue.textContent = volumePercent + '%';
                }
            }
        }
        
        // Sync controls when core components are ready
        function waitForCore() {
            if (window.ptsCore) {
                syncDevControls();
                // Listen for settings changes
                if (window.ptsCore.settingsStore) {
                    window.ptsCore.settingsStore.onChange(syncDevControls);
                }
            } else {
                setTimeout(waitForCore, 100);
            }
        }
        
        // Start waiting for core components
        setTimeout(waitForCore, 500);
    </script>
</body>
</html> 